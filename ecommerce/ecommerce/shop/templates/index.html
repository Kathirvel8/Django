{% extends 'base.html' %}
{% load static %}
{% comment %} {% block css %}
<link rel="stylesheet" href="{% static 'style.css' %}">
{% endblock %} {% endcomment %}
{% block content %}
<div class="index-body">
    <div class="container">
    <h1>Our Products</h1><br>
    {% for category, products in all_products.items %}
        <h2 class="product-category">{{category| capfirst}}</h2>
        <div class="products">
            {% for product in products%}
                <div class="product">
                    <img src={{product.thumbnail}} alt="Product 1">
                    <h4>{{product.title}}</h4>
                    <div class="price">
                        <span class="original-price">${{product.price}}</span>
                        <span class="discount">{{product.discountPercentage}}%</span>
                    </div>
                    <div class="final-price">60</div>
                    <form action="{% url 'add_to_cart' product.id %}" method="POST">
                        {% csrf_token %}
                        <input type="hidden" name="id" value="{{product.id}}">
                        <input type="hidden" name="title" value="{{product.title}}">
                        <input type="hidden" name="price" value="{{product.price}}">
                        <input type="hidden" name="discount" value="{{product.discountPercentage}}">
                        <input type="hidden" name="thumbnail" value="{{ product.thumbnail }}">
                        
                        <button type="submit" id="cart-btn">Add to Cart</button>
                        {% if added_item_id == product.id %}
                            <p class="cart-text" style="color: green; padding-top: 10px;">Item added to cart</p>
                        {% endif%}
                    </form>
                </div>
            {% endfor %}
        </div>
    {% endfor %}
    <div class="container">

    </div>
</div>
</div>
<script>
    
    function calculateFinalPrice(price, discount) {
        const discountAmount = price * (discount / 100);
        const finalPrice = price - discountAmount;
        return finalPrice;
    }

    const products = document.querySelectorAll('.product');
    products.forEach(product => {
        const priceElement = product.querySelector('.original-price');
        const discountElement = product.querySelector('.discount');
        const finalPriceElement = product.querySelector('.final-price');
        
        const price = parseFloat(priceElement.textContent.replace('$', ''));
        const discount = parseFloat(discountElement.textContent);
        
        const finalPrice = calculateFinalPrice(price, discount);
        finalPriceElement.textContent = "$" + finalPrice.toFixed(2);
    });
</script>

{% endblock %}